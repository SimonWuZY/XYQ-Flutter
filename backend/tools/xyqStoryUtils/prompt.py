from typing import Optional


def demo_story_prompt() -> str:
    """
    Obtain the story demos
    
    Returns:
        string type: story demos
    """

    demo_fragments = [("故事大纲：1.在一个风和日丽的海岛上，有一个年轻的灯塔守望者，他的每天工作就是点亮灯塔、提供灯光，为远处海上航行的船只指明方向。"
                       "2.然而，每当海风呼啸，狂风暴雨之际，灯塔的灯光总会摇摇欲坠，甚至有些时候会熄灭，给航行的船只带来危险。"
                       "3.故事应着重描述守望者如何面对温暖安逸的日子和风雨雷电的夜晚，如何坚持克服困难继续点亮灯塔、为船只提供光明。在此过程中，他从未放弃，一直坚守自己的工作，展示出了他的勇气与决心。"
                       "4.故事结尾部分可以讲述他最终克服困难，成功烘亮灯塔，为所有船只安全指明方向，赢得了所有人的尊重和赞美。另外，还可以强调出他在坚持和努力的过程中所获得的内心成长和变化，以及他所启示的人生理念或道德教诲。"
                       "5.还可以在故事中加入其他角色，如其他的岛屿居民、船只的船长等，他们可以通过他们的话语和行动反映和强调主人公不放弃的精神。"
                       "按照此大纲设计故事内容和情节"),

                      ("你将要写一篇名为《诺言的重量》的儿童故事。在这个故事中，一只名叫安吉的小熊承诺给他的朋友佩奇找一朵最美的花。但在路上，遇到了很多诱惑和困难，安吉将如何兑现他的承诺？"
                       "请参考下面的大纲完成你的故事创作，控制在一千字以内，并确保主题突出：诚实守信至关重要。"
                       "故事大纲：1.安吉和佩奇是好朋友，一天，佩奇为了安吉的生日，答应送给他一朵最美的花。"
                       "2.他在寻找花的途中，遇到了晚饭的诱惑、刺猬的欺骗等困难。"
                       "3.在选择诚实守信和不诚信之间，经过艰难思考后，安吉决定坚守他的诺言。"
                       "4.安吉最后不但找到了花，还因为他的坚持和诚实，赢得了所有朋友们的尊敬。"),

                      (
                          "你的任务是创作一篇名为《星星的秘密》的儿童故事。""这个故事要描述一个名叫露西的小女孩，因为对星星满怀好奇，决心寻找星星的秘密，结果发现一个绝对措手不及的真相。"
                          "请参考以下大纲，确保你的故事不超过一千字，并要突显出好奇心引领我们探索未知的主题。"
                          "故事大纲：1.露西是一个天真且充满好奇心的小女孩，她总是盯着夜晚的星星，想知道它们是如何点亮夜空的。"
                          "2.一天，她决定制作自己的天文望远镜，希望看个清楚。无论家人如何劝阻，对未知的热情让露西坚定了自己的决心。"
                          "3.描绘她如何凭借着自己的资源，勇敢地做出望远镜，以及使用望远镜探索星星的过程。"
                          "4.露西通过自己制作的望远镜发现了夜空中的星星其实是由星星群组成，每一颗星星都是一个小小的世界。"
                          "5.这个故事将强调好奇心驱动我们去探索和理解这个世界的重要性。"),

                      (
                          "你的任务是写一篇名为《和善的小马乔治》的儿童故事。这篇故事主要讲述了乔治克服与其他动物的争端和误解，通过有效的沟通与配合，最终解决了真正的问题。请参照所给的大纲，创作你的故事，确保整个故事的长度不超过一千字，主题突出。"
                          "故事大纲：1.故事中的主角是一只年轻善解人意的小马乔治，他住在一个安静的农场上。"
                          "2.他的朋友，鸭子丹尼，有一天和其他农场的动物发生了争执，乔治发现了这个问题。"
                          "3.小马乔治努力去理解事情的来龙去脉，并分别与冲突的每一方进行了沟通。"
                          "4.通过沟通，乔治了解了每个人的观点，他明白了他们的误会和冲突的真正原因。"
                          "5.最后，乔治帮助他们把问题说开，大家一起找到了解决问题的方法，和平解决了争端。"),

                      (
                          "你的任务是创作一部名为《小鸟迪迪的飞翔之旅》的儿童故事。故事的主人公，小鸟迪迪，需要克服自我怀疑，勇敢地尝试飞翔，最终成功翱翔天际。请根据下面的大纲来设计你的故事，保证故事的字数不超过一千字。"), ]

    demo_answers = [("一位名叫杰克的年轻人来到了风景秀美的无名海岛，他被任命为新的灯塔守望者。映入眼帘的，是那座孤独而神秘的灯塔，站在岛的最高点，仿佛随时掌握着海上的一切秘密。"
                     "杰克开始了他的新生活和工作，每天日出而作，日落而息，忙碌其中。他清理灯塔、烧灯油，照亮漆黑的海面，为航行的船只指明方向。"
                     "他享受着那份宁静和满足。然而，挑战接踵而至。有一天，海岛上狂风大作，波涛汹涌。风雨中的灯塔显得极为脆弱，灯光在摇摆中渐渐微弱，甚至一度熄灭。"
                     "杰克在风暴中倍感压力，但他没有退缩，反而更坚定了他守护灯塔、保护船只安全的决心。杰克决定提升灯塔的防风能力，他参照岛上的树木，修改灯塔的结构，使其能在风暴中保持稳定。"
                     "他还发明了新的灯光装置，使灯光更亮、更稳定。他的努力使灯塔在风暴中变得越来越坚固，而他本身，也在过程中收获了力量和智慧。再次的风暴来临，杰克淡定面对。"
                     "经过改良的灯塔在狂风暴雨中稳如磐石，杰克的信心也更加坚定。他熄灭了旧的灯光，点亮了新的灯光，家园再次被光明笼罩。在最黑暗的风暴中，他成功地引导了迷失的船只安全抵达港湾。"
                     "杰克的勇气和坚韧得到了岛民和船员们的认可，他们为他举行了一场盛大的庆祝活动，他也获得了“勇敢的灯塔守望者”的称号。他笑着告诉大家：“每一次的努力，都是为了那未知的光。”"
                     "这就是他坚守岗位的初衷和动力，也成了岛上每一个人努力生活的信念。"),

                    ("在一个阳光灿烂的日子里，小熊安吉和他的好朋友小猪佩奇在森林里玩耍。这天是安吉的生日，佩奇答应送给他一朵最美的花。佩奇穿过森林，越过小溪，向着他知道的一片花海走去。"
                     "途中，他碰到了一位猫咪，手里拿着一大块肥美的鱼。猫咪说，这块鱼可以用来换他手中的那朵平凡的小花。佩奇尝试过的鱼十分美味，但他想起了答应给安吉的那朵最美的花，他拒绝了猫咪，坚定地走向他的目标。"
                     "后来，他又遇到了一只刺猬，刺猬告诉他那朵花藏在一座危险的山里。佩奇顿时害怕起来，但他还是勇往直前，因为他想起了他对安吉的诺言。他走上山，走进洞穴，终于在一片黑暗中找到了那朵花。"
                     "这朵花其实并不安全，而且非常难找，但是当他看到它时，他知道一切都值得了。这一天，当安吉收到那朵花的时候，他向佩奇说出了他的感谢，他说：“佩奇，你是我见过的最诚实和最守信的朋友。”"
                     "佩奇笑了，他告诉安吉他是怎么做到的。他的友谊告诉了所有的动物一个道理：诚实守信是每一个动物都应该有的品质。最后，小熊安吉和小猪佩奇还有他们的朋友们一起，开心地庆祝了安吉的生日。"
                     "他们一起吃着蛋糕，唱生日歌，还有那朵最美的花，它在他们的心中闪亮着光芒。"),

                    ("露西是一个非常聪明好奇的小女孩，每次看到满天繁星，她总是充满了好奇心。"
                     "星星是如何出来的呢，它们为什么能在夜里发光呢？”露西歪着头思考。为了解答自己的疑惑，露西决定，她要制作一个望远镜，去探索星星的秘密。"
                     "露西用几个月的零花钱，买来了所有制作望远镜需要的东西。她不断试验，不断改进，经过了无数次的失败，她终于完成了自己的望远镜。"
                     "那一夜，露西兴奋地抬起望远镜，对准了天空。她一看，就看呆了，原来，每一颗星星都是由更小的星星群组成的。露西激动万分，咯咯地笑了出来。"
                     "她知道，自己见到的是其他人没有看到的，那个属于星星的秘密。露西感谢自己的好奇心，是它帮助她找到了这个美丽的秘密。"
                     "她决定，无论长大后做什么，都要保持这颗探索未知的好奇心。这个故事告诉我们，好奇心是人类进步的推动力，它驱使我们去探索未知的世界，感知生活的美好。"),

                    ("在一个宁静的农场中，住着一只名叫乔治的小马。一天，他的朋友鸭子丹尼和农场的其他动物发生了争论，使得农场充满了紧张的气氛。"
                     "乔治看到这一切，决定采取行动。他首先去找丹尼，耐心地听他把事情的经过全部说了出来，然后又去找那些与丹尼发生冲突的动物，听取他们对事情的看法。"
                     "乔治发现他们其实都是因为一点小误会而产生了冲突。于是他决定帮他们解开这个误会。乔治召集了大家，在他的引导下，大家都把自己心里的想法说了出来。"
                     "原来，大家的意见并没有那么对立，他们都是想为农场做出贡献，只是方法上有些分歧。乔治通过给动物们创造平和的沟通环境并购根据大家的看法给出了合适的合作想法，最终动物们一致同意按照乔治方法进行合作。"
                     "最后，冲突得以解决，农场恢复了宁静，大家都感谢乔治的帮助。乔治告诉大家，只要我们愿意坐下来和平交谈，大部分问题都能得到解决。这个故事告诉我们，通过沟通和理解，我们可以解决许多问题。"
                     "不要让误解成为彼此的障碍，要有勇气面对问题，找到解决问题的方法。"),

                    ("在一个美丽的森林中，住着一只名叫迪迪的小鸟。他一直渴望能像其他鸟儿一样自由自在地在天空中飞翔。然而，他觉得自己的翅膀不够强壮，总是害怕自己飞不高，飞不远。"
                     "一天，迪迪遇到了一只聪明的老鹰。老鹰看到迪迪愁眉苦脸的样子，便问他为什么如此忧愁。迪迪告诉老鹰他渴望飞翔，但又担心自己做不到。"
                     "老鹰笑着说：“每个人都有自己的天赋，你也一定可以飞翔。”老鹰告诉迪迪，他需要相信自己，勇敢地去尝试。于是，迪迪鼓起勇气，开始尝试飞翔。一开始，他飞得并不高，也不远，但他并不气馁。"
                     "他不断地练习，不断地挑战自己。每当他感到挫败时，他就会想起老鹰的话，相信自己，继续努力。终于，他飞得越来越高，越来越远，他感到自己仿佛成了一只真正的鸟。"
                     "迪迪欣喜若狂，他感谢老鹰给他的鼓励和指导。他决定把自己的经历告诉其他的鸟儿，鼓励他们也勇敢地去尝试。迪迪的飞翔之旅告诉我们，无论遇到什么困难，只要我们相信自己，勇敢地去尝试，就一定能够成功。"), ]

    demos = [f"问题：{demo_fragment}\n 回答：{demo_answer}\n" for demo_fragment, demo_answer in
             zip(demo_fragments, demo_answers)]
    demos_prompt = ' '.join(demos).strip()
    print("\n\ndemo_prompt: " + demos_prompt + "\n\n")
    return demos_prompt


def story_prompt(question: str) -> str:
    """
    The final story prompt

    Args:
        question (str): user input

    Returns:
        str: story prompt to generate new story
    """

    story_question = f'你的任务是{question},不要为角色命名'
    demo_stories = demo_story_prompt()
    prompt = f'{demo_stories}\n问题：{story_question}\n回答： '
    print("\n\nprompt: " + prompt + "\n\n")
    return prompt


def demo_extract_fragments() -> str:
    """
    return demos for extracting fragments

    Returns:
        str: demos about extracting
    """
    demo_fragments = [
        ("《彩虹镇的宝藏》&"
         "在一个遥远的国度里，有一个被郁郁葱葱的森林和蜿蜒的河流环绕的小镇，名叫“彩虹镇”。小镇上的居民们生活得很和谐，他们的房子涂着各种鲜艳的颜色，就像彩虹一样美丽。&在彩虹镇的边缘，住着一个叫莉莉的小女孩。莉莉有着一头金色的卷发和充满好奇的大眼睛。她最喜欢的事就是探索森林，寻找新奇的植物和动物。&"
         "一天，莉莉在森林里发现了一朵会唱歌的神奇花朵。这朵花唱着悦耳的旋律，莉莉听得入了迷。&"
         "花朵唱完后，告诉莉莉一个秘密：森林深处有一个被遗忘的宝藏，它属于那些勇敢和善良的孩子们。莉莉的心中燃起了希望的火花，她决定踏上寻宝之旅。&"
         "莉莉带上了自己的小背包，里面装着水、面包和一张手绘的地图。在旅途中，她帮助了一只受伤的小鸟，找到了丢失的小猫，并与一只友好的松鼠成为了朋友。&"
         "经过一系列的冒险，莉莉终于来到了宝藏的所在地。她发现宝藏其实是一间充满书籍和玩具的小屋。小屋的墙上写着：“真正的宝藏是好奇心和乐于助人的心。”&"
         "莉莉带着满心的喜悦和小屋里的一些书籍回到了彩虹镇，与所有的孩子们分享了她的故事和宝藏。她的故事迅速传遍了整个小镇，激励着每一个孩子去探索未知，去帮助他人。&从那以后，莉莉成了彩虹镇的英雄，她的故事告诉大家，最宝贵的财富不是金银财宝，而是我们心中的梦想、勇气和乐于助人的精神。彩虹镇的每个孩子都被莉莉的勇气所鼓舞，他们知道，只要拥有一颗善良和好奇的心，每个人都能找到属于自己的宝藏。&"),
        ("《杰米的宝藏之旅》&"
         "在一个遥远的国度里，有一片被阳光照耀的金色麦田，麦田中坐落着一个名叫“风车村”的小村庄。&"
         "村庄里住着一个好奇心旺盛的小男孩，他的名字叫杰米。杰米有着一头乌黑的头发和明亮的大眼睛，他总是梦想着探索未知的世界。&"
         "一天，杰米在村边的小溪旁捡到了一张古老的地图，地图上标记着一条通往神秘宝藏的路线。杰米的心中燃起了冒险的火焰，他决定踏上寻宝之旅。他告别了父母和朋友们，带着地图和一背包的必需品，向着地图上的“X”标记出发了。&"
         "杰米的旅程充满了挑战。他首先穿过了一片幽暗的森林，森林里住着各种各样的动物，有的友好，有的则不那么友好。&"
         "一只狡猾的狐狸试图骗走他的背包，但杰米机智地用一串葡萄和狐狸交换了平安通过森林的路线。&"
         "接着，杰米来到了一片广阔的草原，草原上空飞翔着各种奇异的鸟类。一只巨大的鹰在天空中盘旋，它看到了杰米，便俯冲下来，想要将他抓走。&"
         "杰米不慌不忙，从背包中拿出一张彩色的布，在空中挥舞，成功地分散了鹰的注意力，趁机逃离了草原。&"
         "最后，杰米到达了一片崎岖的山脉，山脉中隐藏着许多秘密的洞穴。&"
         "在洞穴中，杰米遇到了一个古老的守护者，守护者问他三个谜题，只有答对了才能继续前进。杰米凭借他的智慧和勇气，一一解开了谜题，守护者满意地点了点头，为他打开了通往宝藏的大门。&"
         "当杰米走进藏宝室，他惊讶地发现，所谓的宝藏并不是金银财宝，而是满屋子的书籍和知识。&"
         "杰米意识到，真正的宝藏是知识和智慧。他带着满载书籍的背包回到了村庄，与村民们分享了他的发现。从此，风车村成为了一个充满知识和智慧的地方，而杰米的故事也激励着每一个孩子去勇敢地追求自己的梦想。&"
         "杰米的故事告诉我们，最宝贵的财富不是金银财宝，而是我们心中的梦想和不懈追求。&"),
        ("《和谐村的传说 —— 艾拉的奇幻之旅》&"
         "在一片神秘的森林中，隐藏着一个和谐的小村庄。村庄里的人们和睦相处，生活平静而幸福。&"
         "艾拉，一个有着金色长发和蓝眼睛的小女孩，梦想着成为像父母一样的医生，帮助所有人。&"
         "一天，艾拉在森林里听到了关于“和谐之心”的传说，她决定去寻找这颗能实现愿望的宝石。&"
         "艾拉的旅程开始了，她遇到了勇敢的狐狸，它帮助她逃离了凶猛的野狼。&"
         "智慧的老猫头鹰告诉艾拉，要找到宝石，她必须通过勇气、智慧和爱心的考验。&"
         "艾拉勇敢地穿过了充满迷雾和奇怪声音的“恐惧之谷”，克服了内心的恐惧。在巨大的迷宫中，艾拉用她的智慧找到了通往宝石的出口。艾拉展现了她的爱心，照顾了一只受伤的小鹿，并在它的帮助下找到了“和谐之心”。&"
         "艾拉许下了愿望，宝石发出耀眼的光芒，化作一道光飞向了天空，照亮了整个村庄。艾拉带着宝石的力量回到了村庄，她的勇气、智慧和爱心激励了所有的村民。&"
         "艾拉成为了村庄的英雄，她的故事和“和谐之心”的传说被永远地留在了人们的心中。&"),
    ]
    demo_answers = [
        ("《和谐村的传说 —— 艾拉的奇幻之旅》&"
         "在一片神秘的森林中，隐藏着一个和谐的小村庄。村庄里的人们和睦相处，生活平静而幸福。&"
         "艾拉，一个有着金色长发和蓝眼睛的小女孩，梦想着成为像父母一样的医生，帮助所有人。&"
         "一天，艾拉在森林里听到了关于“和谐之心”的传说，她决定去寻找这颗能实现愿望的宝石。&"
         "艾拉的旅程开始了，她遇到了勇敢的狐狸，它帮助她逃离了凶猛的野狼。&"
         "智慧的老猫头鹰告诉艾拉，要找到宝石，她必须通过勇气、智慧和爱心的考验。&"
         "艾拉勇敢地穿过了充满迷雾和奇怪声音的“恐惧之谷”，克服了内心的恐惧。&"
         "在巨大的迷宫中，艾拉用她的智慧找到了通往宝石的出口。&"
         "艾拉展现了她的爱心，照顾了一只受伤的小鹿，并在它的帮助下找到了“和谐之心”。&"
         "艾拉许下了愿望，宝石发出耀眼的光芒，化作一道光飞向了天空，照亮了整个村庄。&"
         "艾拉带着宝石的力量回到了村庄，她的勇气、智慧和爱心激励了所有的村民。&"
         "艾拉成为了村庄的英雄，她的故事和“和谐之心”的传说被永远地留在了人们的心中。&"),
        ("《杰米的宝藏之旅》&"
         "在一个遥远的国度里，有一片被阳光照耀的金色麦田，麦田中坐落着一个名叫“风车村”的小村庄。&"
         "村庄里住着一个好奇心旺盛的小男孩，他的名字叫杰米。杰米有着一头乌黑的头发和明亮的大眼睛，他总是梦想着探索未知的世界。&"
         "一天，杰米在村边的小溪旁捡到了一张古老的地图，地图上标记着一条通往神秘宝藏的路线。&"
         "杰米的心中燃起了冒险的火焰，他决定踏上寻宝之旅。&"
         "他告别了父母和朋友们，带着地图和一背包的必需品，向着地图上的“X”标记出发了。&"
         "杰米的旅程充满了挑战。他首先穿过了一片幽暗的森林，&"
         "森林里住着各种各样的动物，有的友好，有的则不那么友好。&"
         "一只狡猾的狐狸试图骗走他的背包，但杰米机智地用一串葡萄和狐狸交换了平安通过森林的路线。&"
         "接着，杰米来到了一片广阔的草原，草原上空飞翔着各种奇异的鸟类。&"
         "一只巨大的鹰在天空中盘旋，它看到了杰米，便俯冲下来，想要将他抓走。&"
         "杰米不慌不忙，从背包中拿出一张彩色的布，在空中挥舞，成功地分散了鹰的注意力，趁机逃离了草原。&"
         "最后，杰米到达了一片崎岖的山脉，山脉中隐藏着许多秘密的洞穴。&"
         "在洞穴中，杰米遇到了一个古老的守护者,&"
         "守护者问他三个谜题，只有答对了才能继续前进。&"
         "杰米凭借他的智慧和勇气，一一解开了谜题，守护者满意地点了点头，为他打开了通往宝藏的大门。&"
         "当杰米走进藏宝室，他惊讶地发现，所谓的宝藏并不是金银财宝，而是满屋子的书籍和知识。&"
         "杰米意识到，真正的宝藏是知识和智慧。&"
         "他带着满载书籍的背包回到了村庄，与村民们分享了他的发现。&"
         "从此，风车村成为了一个充满知识和智慧的地方，而杰米的故事也激励着每一个孩子去勇敢地追求自己的梦想。&"
         "杰米的故事告诉我们，最宝贵的财富不是金银财宝，而是我们心中的梦想和不懈追求。&"),
        ("《彩虹镇的宝藏》&"
         "在一个遥远的国度里，有一个被郁郁葱葱的森林和蜿蜒的河流环绕的小镇，名叫“彩虹镇。&"
         "小镇上的居民们生活得很和谐，他们的房子涂着各种鲜艳的颜色，就像彩虹一样美丽。&"
         "在彩虹镇的边缘，住着一个叫莉莉的小女孩。莉莉有着一头金色的卷发和充满好奇的大眼睛。&"
         "她最喜欢的事就是探索森林，寻找新奇的植物和动物。&"
         "一天，莉莉在森林里发现了一朵会唱歌的神奇花朵。这朵花唱着悦耳的旋律，莉莉听得入了迷。&"
         "花朵唱完后，告诉莉莉一个秘密：森林深处有一个被遗忘的宝藏，它属于那些勇敢和善良的孩子们。&"
         "莉莉的心中燃起了希望的火花，她决定踏上寻宝之旅。&"
         "莉莉带上了自己的小背包，里面装着水、面包和一张手绘的地图。&"
         "在旅途中，她帮助了一只受伤的小鸟，&"
         "找到了丢失的小猫&"
         "并与一只友好的松鼠成为了朋友。&"
         "经过一系列的冒险，莉莉终于来到了宝藏的所在地。她发现宝藏其实是一间充满书籍和玩具的小屋。&"
         "小屋的墙上写着：“真正的宝藏是好奇心和乐于助人的心。”&"
         "莉莉带着满心的喜悦和小屋里的一些书籍回到了彩虹镇，与所有的孩子们分享了她的故事和宝藏。&"
         "她的故事迅速传遍了整个小镇，激励着每一个孩子去探索未知，去帮助他人。&"
         "从那以后，莉莉成了彩虹镇的英雄，她的故事告诉大家，最宝贵的财富不是金银财宝，而是我们心中的梦想、勇气和乐于助人的精神。&"
         "彩虹镇的每个孩子都被莉莉的勇气所鼓舞，他们知道，只要拥有一颗善良和好奇的心，每个人都能找到属于自己的宝藏。&")
    ]

    demos = [f"问题：{demo_fragment}\n 回答:{demo_answer}\n" for demo_fragment, demo_answer in
             zip(demo_fragments, demo_answers)]

    demos = ''.join(demos).strip()
    return demos


def extract_prompt(original_fragments: str) -> str:
    """
    return prompt to extract the original fragments
    
    Args:
        original_fragments (str): the given original fragments 

    Returns:
        str: prompt to extract the original fragments
    """
    demos = demo_extract_fragments()
    demand = '请根据<问题>补全<回答>'
    prompt = f'样例如下：\n```{demos}```\n问题:{original_fragments}\n回答：'
    print(prompt)
    return prompt


def demo_polish_fragment() -> str:
    """
    return demos for fragments extracting

    Returns:
        str: demos for  fragments extracting
    """
    demo_questions = [
        ("《彩虹镇的宝藏》&"
         "在一个遥远的国度里，有一个被郁郁葱葱的森林和蜿蜒的河流环绕的小镇，名叫“彩虹镇。&"
         "小镇上的居民们生活得很和谐，他们的房子涂着各种鲜艳的颜色，就像彩虹一样美丽。&"
         "在彩虹镇的边缘，住着一个叫莉莉的小女孩。莉莉有着一头金色的卷发和充满好奇的大眼睛。&"
         "她最喜欢的事就是探索森林，寻找新奇的植物和动物。&"
         "一天，莉莉在森林里发现了一朵会唱歌的神奇花朵。这朵花唱着悦耳的旋律，莉莉听得入了迷。&"
         "花朵唱完后，告诉莉莉一个秘密：森林深处有一个被遗忘的宝藏，它属于那些勇敢和善良的孩子们。&"
         "莉莉的心中燃起了希望的火花，她决定踏上寻宝之旅。&"
         "莉莉带上了自己的小背包，里面装着水、面包和一张手绘的地图。&"
         "在旅途中，她帮助了一只受伤的小鸟，&"
         "找到了丢失的小猫&"
         "并与一只友好的松鼠成为了朋友。&"
         "经过一系列的冒险，莉莉终于来到了宝藏的所在地。她发现宝藏其实是一间充满书籍和玩具的小屋。&"
         "小屋的墙上写着：“真正的宝藏是好奇心和乐于助人的心。”&"
         "莉莉带着满心的喜悦和小屋里的一些书籍回到了彩虹镇，与所有的孩子们分享了她的故事和宝藏。&"
         "她的故事迅速传遍了整个小镇，激励着每一个孩子去探索未知，去帮助他人。&"
         "从那以后，莉莉成了彩虹镇的英雄，她的故事告诉大家，最宝贵的财富不是金银财宝，而是我们心中的梦想、勇气和乐于助人的精神。&"
         "彩虹镇的每个孩子都被莉莉的勇气所鼓舞，他们知道，只要拥有一颗善良和好奇的心，每个人都能找到属于自己的宝藏。&"),
        ("《杰米的宝藏之旅》&"
         "在一个遥远的国度里，有一片被阳光照耀的金色麦田，麦田中坐落着一个名叫“风车村”的小村庄。&"
         "村庄里住着一个好奇心旺盛的小男孩，他的名字叫杰米。杰米有着一头乌黑的头发和明亮的大眼睛，他总是梦想着探索未知的世界。&"
         "一天，杰米在村边的小溪旁捡到了一张古老的地图，地图上标记着一条通往神秘宝藏的路线。&"
         "杰米的心中燃起了冒险的火焰，他决定踏上寻宝之旅。&"
         "他告别了父母和朋友们，带着地图和一背包的必需品，向着地图上的“X”标记出发了。&"
         "杰米的旅程充满了挑战。他首先穿过了一片幽暗的森林，&"
         "森林里住着各种各样的动物，有的友好，有的则不那么友好。&"
         "一只狡猾的狐狸试图骗走他的背包，但杰米机智地用一串葡萄和狐狸交换了平安通过森林的路线。&"
         "接着，杰米来到了一片广阔的草原，草原上空飞翔着各种奇异的鸟类。&"
         "一只巨大的鹰在天空中盘旋，它看到了杰米，便俯冲下来，想要将他抓走。&"
         "杰米不慌不忙，从背包中拿出一张彩色的布，在空中挥舞，成功地分散了鹰的注意力，趁机逃离了草原。&"
         "最后，杰米到达了一片崎岖的山脉，山脉中隐藏着许多秘密的洞穴。&"
         "在洞穴中，杰米遇到了一个古老的守护者,&"
         "守护者问他三个谜题，只有答对了才能继续前进。&"
         "杰米凭借他的智慧和勇气，一一解开了谜题，守护者满意地点了点头，为他打开了通往宝藏的大门。&"
         "当杰米走进藏宝室，他惊讶地发现，所谓的宝藏并不是金银财宝，而是满屋子的书籍和知识。&"
         "杰米意识到，真正的宝藏是知识和智慧。&"
         "他带着满载书籍的背包回到了村庄，与村民们分享了他的发现。&"
         "从此，风车村成为了一个充满知识和智慧的地方，而杰米的故事也激励着每一个孩子去勇敢地追求自己的梦想。&"
         "杰米的故事告诉我们，最宝贵的财富不是金银财宝，而是我们心中的梦想和不懈追求。&"),
        ("《和谐村的传说 —— 艾拉的奇幻之旅》&"
         "在一片神秘的森林中，隐藏着一个和谐的小村庄。村庄里的人们和睦相处，生活平静而幸福。&"
         "艾拉，一个有着金色长发和蓝眼睛的小女孩，梦想着成为像父母一样的医生，帮助所有人。&"
         "一天，艾拉在森林里听到了关于“和谐之心”的传说，她决定去寻找这颗能实现愿望的宝石。&"
         "艾拉的旅程开始了，她遇到了勇敢的狐狸，它帮助她逃离了凶猛的野狼。&"
         "智慧的老猫头鹰告诉艾拉，要找到宝石，她必须通过勇气、智慧和爱心的考验。&"
         "艾拉勇敢地穿过了充满迷雾和奇怪声音的“恐惧之谷”，克服了内心的恐惧。&"
         "在巨大的迷宫中，艾拉用她的智慧找到了通往宝石的出口。&"
         "艾拉展现了她的爱心，照顾了一只受伤的小鹿，并在它的帮助下找到了“和谐之心”。&"
         "艾拉许下了愿望，宝石发出耀眼的光芒，化作一道光飞向了天空，照亮了整个村庄。&"
         "艾拉带着宝石的力量回到了村庄，她的勇气、智慧和爱心激励了所有的村民。&"
         "艾拉成为了村庄的英雄，她的故事和“和谐之心”的传说被永远地留在了人们的心中。&"),
    ]

    demo_answers = [
        ("《杰米的宝藏之旅》&"
         "在一个遥远的地方，有一片金色的麦田，阳光洒满了整个地方。那里有一个小村庄，叫做“风车村”。&"
         "在这个村庄里，住着一个叫杰米的小男孩。他总是很好奇，喜欢冒险。他有一头黑黑的头发和亮亮的大眼睛。&"
         "有一天，杰米在小溪旁发现了一张旧地图。地图上画了一条通向宝藏的路线。&"
         "杰米非常兴奋，决定去找宝藏。他告别了爸爸妈妈和朋友，带着地图和一些必需品，开始了他的冒险。&"
         "杰米的旅程充满了挑战。首先，他穿过了一片黑暗的森林。森林里有很多动物，有的很友好，有的很凶。&"
         "有一只狐狸想骗走杰米的背包，但杰米聪明地用一串葡萄和狐狸换来了安全通过的路。&"
         "然后，杰米来到了一片大草原，草原上有各种各样的奇怪鸟儿飞来飞去。&"
         "一只大鹰从天空中俯冲下来，想抓走杰米。&"
         "杰米不慌不忙，从背包里拿出一张彩色的布，挥舞着吸引了鹰的注意，趁机逃走了。&"
         "最后，杰米来到了崎岖的山脉，这里有很多秘密的洞穴。&"
         "在一个洞穴里，杰米遇到了一个古老的守护者。守护者问了他三个谜语，只有答对了才能继续。&"
         "杰米用他的智慧和勇气答对了所有谜题，守护者高兴地打开了通往宝藏的大门。&"
         "当杰米走进藏宝室，他发现宝藏不是金银，而是满满的书和知识。&"
         "杰米明白了，真正的宝藏是知识。他带着书回到村里，与大家分享。&"
         "从此，风车村变成了一个充满知识和智慧的地方。杰米的故事激励着每个孩子去追求梦想。&"
         "杰米的故事告诉我们，最宝贵的财富是梦想和不懈的追求。&"),
        ("《和谐村的传说 —— 艾拉的奇幻之旅》&"
         "在一片神秘的森林中，藏着一个和谐的小村庄。村里的人们生活得很开心。&"
         "艾拉，一个有着金色长发和蓝眼睛的小女孩，梦想着成为像爸爸妈妈一样的医生，帮助所有人。&"
         "有一天，小女孩在森林里听说了一个关于“和谐之心”的传说，她决定去寻找这颗能实现愿望的宝石。&"
         "小女孩的冒险开始了，她遇到了一只勇敢的狐狸，狐狸帮她逃离了凶猛的野狼。&"
         "聪明的老猫头鹰告诉小女孩，要找到宝石，她需要通过勇气、智慧和爱心的考验。&"
         "小女孩勇敢地穿过了“恐惧之谷”，克服了心里的恐惧。&"
         "在巨大的迷宫里，小女孩用她的智慧找到了通往宝石的出口。&"
         "小女孩展现了她的爱心，照顾了一只受伤的小鹿，小鹿带她找到了“和谐之心”。&"
         "小女孩许下愿望，宝石发出耀眼的光芒，飞向天空，照亮了整个村庄。&"
         "小女孩带着宝石的力量回到村庄，她的勇气、智慧和爱心激励了所有村民。&"
         "小女孩成为了村庄的英雄，她的故事和“和谐之心”的传说被永远记在了人们的心中。&"),
        ("《彩虹镇的宝藏》&"
         "在一个遥远的国度里，有一个小镇叫“彩虹镇”。镇上到处是五颜六色的房子，像彩虹一样美丽。&"
         "在彩虹镇的边缘，住着一个叫莉莉的小女孩。她有金色的卷发和大大的好奇眼睛。小女孩喜欢在森林里找新奇的植物和动物。&"
         "一天，小女孩在森林里发现了一朵会唱歌的花。这朵花唱着美妙的歌，小女孩听得很开心。&"
         "花朵唱完后，告诉小女孩一个秘密：森林深处有一个宝藏，只属于勇敢和善良的孩子们。小女孩决定去找这个宝藏。&"
         "小女孩背上了小背包，里面装着水、面包和一张地图。在路上，她帮助了一只受伤的小鸟，找到了丢失的小猫，还和一只松鼠成了朋友。&"
         "经过许多冒险，小女孩终于找到了宝藏。她发现宝藏是一间有很多书和玩具的小屋。墙上写着：“真正的宝藏是好奇心和乐于助人的心。”&"
         "小女孩开心地带着一些书回到了彩虹镇，把故事和宝藏分享给所有孩子。她的故事激励着每个孩子去探索和帮助别人。&"
         "从那以后，小女孩成了彩虹镇的英雄。她的故事告诉大家，最宝贵的财富是我们的梦想、勇气和善良。每个孩子都知道，只要有一颗好奇和善良的心，就能找到自己的宝藏。&")
    ]

    demos = [f"问题：{demo_question}\n 回答:{demo_answer}\n" for demo_question, demo_answer in
             zip(demo_questions, demo_answers)]
    demos = ''.join(demos).strip()
    print(demos)
    return demos


def polish_prompt(extracted_fragment: str) -> str:
    demand = "你的任务是在将文本改为向孩子讲故事的语气, 字数限制在20字以内"
    prompt = f'{demand}\n```{extracted_fragment}```\n'
    print(prompt)
    return prompt


def enrich_fragment_prompt(fragment: str, story: str, specified_style: Optional[str] = None, flag: bool = False) -> str:
    """
    return prompt to enrich the fragment 

    Returns:
        str: the enrich prompt for enriching fragment
    """
    system_prompt = ("现在你是儿童故事大师，我需要你为我丰富故事片段中的一帧画面\n"
                     "接下来我将提供<任务>，<要求>，<完整故事>，<片段>，四个部分的材料，每部分用“## <材料标题>”进行指示\n")
    if specified_style is not None:
        task = ("## <任务>：\n"
                f"请抽取<片段>中的一帧主要画面, 对其进行丰富，使其具有{specified_style}般的画面感:\n")
    else:
        task = ("## <任务>：\n"
                f"请抽取<片段>中的一帧主要画面, 对其进行丰富，使其具有温馨儿童绘本的感觉:\n")

    if flag:
        demand = ("## <要求>：\n"
                  "1. 使用**优美的语言**对其进行丰富\n"
                  "2. 内容**符合**提供的<完整故事>和<片段>\n"
                  "3. 只对<片段>的一个情节进行丰富\n"
                  "4. 不超过于50字\n"
                  "5. 注意使用不会触犯审核的文字\n")
    else:
        demand = ("## <要求>：\n"
                  "1. 使用**优美的语言**对其进行丰富\n"
                  "2. 内容**符合**提供的<完整故事>和<片段>\n"
                  "3. 只对<片段>的一个情节进行丰富\n"
                  "4. 不超过于50字\n")

    story = "## <完整故事>：\n" + story + '\n'
    fragment = "## <片段>：\n" + fragment + '\n'
    prompt = f"{system_prompt}{task}{demand}{story}{fragment}"
    print("\n\n" + prompt + "\n\n")
    return prompt


def pic_prompt_question(enriched_fragment: str, question: Optional[str] = None) -> str:
    """
    The question part for picture prompt

    Args:
        enriched_fragment (str): a enriched fragment
        question (string, optional): special question if needed. Defaults to None.

    Returns:
        string: question part for picture prompt
    """

    if question == None:
        question = '\n问题: 请根据以下文本生成富有画面感的midjourney形式的提示词:'
    else:
        question = '\n问题: ' + question + ': '

    pic_question = question + enriched_fragment

    return pic_question


def demo_pic_prompt(demo_question: str = None) -> str:
    """
    Obtain the picture prompt demos 
    
    Args:
        demo_question(str, optional): the supplementary prompt for specified style generating. Default None
    Returns:
        string type: the picture prompt demos
    """
    if demo_question is None:
        demo_question = "请根据以下文本生成富有画面感的midjourney形式的提示词:"
    else:
        demo_question = f"请根据以下文本生成{demo_question}的midjourney形式的提示词:"

    demo_fragments = [("艾拉住在一座温馨的小屋里，她是个充满梦想的小女孩，渴望成为一名医生。每天早晨，阳光透过窗帘洒在她的房间里，照亮了她书桌上那本翻开的医学书籍。"
                       "艾拉坐在书桌前，认真地读着每一个字，她的眼中闪烁着对知识的渴望和对未来的憧憬。她的房间里挂满了各种医学海报，每一张都代表着她对未来的热忱和追求。"),

                      ("晨曦初照，杰米的身影在轻柔的晨光中拉长。他的背包装满了冒险的必需品：水壶中漾着清澈的溪水，似乎在低语着山川的秘密；食物袋里散发出诱人的香气，"
                       "预示着即将到来的路程的甘甜与辛酸；古旧的地图紧紧卷着，每一道折痕都充满了未知与可能。杰米挺直腰板，肩膀上挎着的小背包仿佛是他的信任伙伴，伴随他走过每一段旅程。"
                       "他的眼神坚定，脚步轻快，踏上了寻找知识和智慧的奇妙之旅。"),

                      ("老猫头鹰的羽毛在微弱的火光中闪耀着神秘的银光。它那洞悉一切的黄色眼睛凝视着女孩，话语中充满了智慧和古老的气息：孩子，要找到这颗宝石，你必须先通过三个考验。它们将测试你的勇气、智慧和诚实。"
                       "只有真正纯净的心，才能揭开隐藏在黑暗中的秘密，唤醒宝石的生命之光。""随着它的话语，一颗璀璨的宝石在夜幕中发出幽幽的光芒，仿佛在诉说着一个未完的故事。"),

                      ("莉莉站在高高的岩石上，她的目光中燃烧着勇气的火焰。她高举着那块古老的地图，仿佛是探寻宝藏的明灯。在她的感召下，彩虹镇的小朋友们围聚在她身边，眼中闪耀着对未知的渴望与对未来的憧憬。"
                       "他们的心灵纯净而美好，每一颗心中都种下了善良与好奇的种子。他们相信，只要跟随莉莉的脚步，心怀善意，勇敢探索，就一定能在彩虹镇的秘密角落，找到属于自己的那份独特宝藏。此刻，孩子们的内心充满了希望与力量，他们准备好了，要一起踏上这段奇妙的冒险之旅。"),

                      ("在遥远的地方，有一个被风车环绕的村庄，那里的田野里种满了金色的麦子。每当微风拂过，麦浪翻滚，仿佛一片金色的海洋。在麦田的边缘，一座古老的风车静静地旋转着，"
                       "它的叶片切割着和煦的阳光，洒下一地的斑驳光影。村民们在这片金黄之中忙碌着，他们的笑声和歌声交织在一起，充满了生活的气息。远方，一座高耸入云的山峦屹立在那里，山上的白雪皑皑，"
                       "与蓝天白云交相辉映。这一切构成了一幅美轮美奂的画面，让人仿佛置身于一个童话世界之中。"),

                      ("在那座连绵起伏的大山之中，隐藏着无数神秘的洞穴。其中一个洞穴里，住着一位古老的守护者。他的身影在微弱的烛光中若隐若现，洞穴里弥漫着一股奇异的气息。守护者注视着站在洞口的年轻男孩杰米，"
                       "他的眼中闪烁着智慧的光芒。他开始向杰米提出三个问题，每个问题都充满哲理，挑战着杰米的智慧和勇气。杰米聚精会神地聆听着，他的心中充满了对未知的向往和好奇，这个神秘的洞穴和守护者，似乎隐藏着无尽的秘密和宝藏。"),

                      ("艾拉踏入“恐惧之谷”，眼前立即被浓雾笼罩，仿佛置身于一片混沌未开的世界。四周弥漫着湿冷的气息，空气中夹杂着诡异而低沉的呻吟声，令人毛骨悚然。她小心翼翼地踩着湿滑的地面，"
                       "每一步都伴随着未知的危险，心跳声在寂静的谷中回荡。"),

                      ("彩虹镇，一个遥远而神秘的国度，藏匿在层峦叠嶂的群山之中。周围，参天大树拔地而起，枝叶繁茂，形成一片绿色的海洋。阳光透过树叶的缝隙，洒下斑驳的光影。弯弯的河流宛如一条银链，"
                       "在绿树的映衬下闪烁着迷人的光芒，静静地流淌着，仿佛在诉说着彩虹镇的古老传说。"),

                      ("在温暖的阳光照耀下，杰米静静地坐在老图书馆的窗边，翻开一页页泛黄的书籍。他的眼前闪过无数前人的智慧，历史的尘埃在空气中跳舞，仿佛诉说着一个个被时间遗忘的故事。杰米的心随着文字的跳跃而悸动，"
                       "他仿佛看到了知识的海洋中，每一滴水珠都闪烁着耀眼的光芒。他明白了，这光芒比任何金银财宝都要珍贵，因为它是无价的，是真正可以穿越时空的宝藏。这一刻，杰米的内心充满了满足和喜悦，"
                       "他知道，从此以后，他将带着这份无价的财富，踏上属于自己的智慧之旅。")]

    demo_answers = [("小女孩艾拉的梦想生活,早晨阳光透过窗帘的温暖场景,沉浸在医学知识海洋中的专注,房间内梦想与追求的象征,动画电影构图,"
                     "利用明亮温暖的色彩和细节描绘来表达艾拉的梦想和对未来的憧憬，"),

                    ("晨曦初照杰米的身影,在朝霞映照下的蜿蜒小径上杰米的剪影拉得很长，背后是渐渐亮起的天空和柔和的晨光,"
                     "早晨的新鲜空气中夹杂着自然的芬芳，预示着新的一天和新旅程的开始,动画电影风格,使用广角镜头的摄影，清晰捕捉细节和晨光下的色彩,"),

                    ("考验勇气、智慧和诚实的旅程,微弱火光中的老猫头鹰银光羽毛,凝视着女孩的黄色眼睛,宝石在夜晚发出的光芒,动画电影构图,"
                     "采用柔和的色彩渐变和细致的纹理描绘来创造一个充满奇幻和深意的场景，"),

                    ("孩子们心中希望与力量,岩石之巅的莉莉与下方的孩子们，他们的身姿勾画出一副期待启程的画面，他们内心的光辉与周围大自然的光芒相互辉映,"
                     "笑容和互相鼓励，满载着希望与梦想的氛围，动画电影感，动感和活力十足,"),

                    ("风车环抱的村落和金色麦子,风轻拂麦田波光粼粼,风车与斑驳光影,村民欢歌笑语的温暖场景,运用细腻的手绘风格和温馨的色调搭配,"
                     "创建如画的田野和人文景致，将角色动作和自然元素融入生动的动画序列中"),

                    ("连绵大山中的神秘洞穴，巨大庄严的古老守护者的身影，杰米的好奇心与向往,电影画面感,运用微妙的光线和阴影，"
                     "以及精细的角色动画来营造情境之中无形的张力和情感的共鸣，"),

                    ("艾拉与浓雾环抱的谷地,混沌仿佛世界起源之地,湿冷气息和不祥之音的空气重压,潜藏危险的脚步与孤独的心跳回音,"
                     "以暗调色彩和雾化效果，结合细微的动画表现和声音层次，营造出一种步步紧张的气氛，"),

                    ("彩虹镇光影斑驳,阳光透过参天大树的缝隙，把彩虹镇的每一处都照亮，呈现出斑驳的光影。弯弯的河流闪烁着耀眼的光芒，仿佛是大自然的灵脉,"
                     "这样的画面将观众带到一个和谐而宁静的世界，其中光与影的完美结合营造了一种梦幻而宁静的氛围,"),

                    ("杰米在老图书馆的学习时光,晒在泛黄书页的暖阳,空中舞动的历史尘埃,内心对知识的欣赏与喜悦,"
                     "动画电影风格,采用暖阳照射和书香四溢的环境效果来创造一个充满智慧与历史氛围的场景，")]

    demos = [f"问题：{demo_question} {demo_fragment}\n 回答：{demo_answer}\n" for demo_fragment, demo_answer in
             zip(demo_fragments, demo_answers)]
    demos_prompt = ' '.join(demos).strip()

    return demos_prompt


def pic_prompt(LLM_prompt: str, special_style: Optional[str] = None) -> str:
    """
    The final prompt for picture generating
    
    Args:
        LLM_prompt (str): prompt from LLM
        special_style (str, optional): style specified by user. Default None
    
    Returns:
        final_prompt (str): the final prompt
    """

    if special_style is None:
        special_style = '水彩风格 '

    final_prompt = special_style + ', ' + LLM_prompt[3:]
    print("\n\n" + final_prompt + "\n\n")
    return final_prompt
